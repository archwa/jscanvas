<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <style>
    html, body {
      width: 100%;
      height: 100%;
      margin: 0px;
      border: 0;
      overflow: hidden; /*  Disable scrollbars */
      display: block;  /* No floating content on sides */
    }
  </style>
  <script type="text/javascript">
    "use strict";

    function randn_bm() {
      var u = 1 - Math.random(), v = 1 - Math.random();
      return Math.abs((Math.sqrt( -2.0 * Math.log( u ) ) * Math.cos( 2.0 * Math.PI * v ) + 3.5) / 7);
    }
    
    // global canvas variables
    const trms = 1000; // tick resolution, milliseconds
    let canvas, ctx, ball, ticks, last, elapsed, dot_list;
    dot_list = [];

    function init_ball() {
      ball = {
        "state": {
          "r": 16*(randn_bm() + 1),
          "color": "#" + Math.round(randn_bm()*128+64).toString(16)
                  + Math.round(randn_bm()*128+64).toString(16)
                  + Math.round(randn_bm()*128+64).toString(16),
        },
        "prev": {}
      };

      ball["state"]["x"] = randn_bm()*(canvas.width - 2*ball["state"]["r"]) + ball["state"]["r"];
      ball["state"]["y"] = randn_bm()*(canvas.height - 2*ball["state"]["r"]) + ball["state"]["r"];
      ball["prev"]["r"] = ball["state"]["r"];
      ball["prev"]["x"] = ball["state"]["x"];
      ball["prev"]["y"] = ball["state"]["y"];
      ball["prev"]["color"] = ball["state"]["color"];
    }

    function init_ticks() {
      ticks = 0;
    }

    function init_canvas() {
      canvas = document.createElement("canvas");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      canvas.tabindex = 0;
      canvas.setAttribute("style", "width: 100%; height: 100%; margin: 0;");
                                  /*+ "left: 0; top: 0;");
                                  + "margin-left:-400px;"
                                  + "top: 50%;"
                                  + "margin-top:-300px;"
                                  + "border: 1px solid black;"
                         );*/
      ctx = canvas.getContext("2d");
      document.body.appendChild(canvas);
      document.addEventListener("keydown", () => dot_list = [], true);
    }

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    // initialization
    function init() {
       window.addEventListener("resize", resizeCanvas, false);
      init_canvas();
      init_ticks();
      init_ball();

      // begin loop
      window.requestAnimationFrame(loop);
    }

    // loop
    function loop(time) {
      if(last === undefined) {
        last = time;
        ball["prev"]["x"] = ball["state"]["x"];
        ball["prev"]["y"] = ball["state"]["y"];
        ball["prev"]["color"] = ball["state"]["color"];
        ball["prev"]["r"] = ball["state"]["r"];
        ball["state"]["x"] = randn_bm()*(canvas.width - 2*ball["state"]["r"]) + ball["state"]["r"];
        ball["state"]["y"] = randn_bm()*(canvas.height - 2*ball["state"]["r"]) + ball["state"]["r"];
        ball["state"]["color"] = "#" + Math.round(randn_bm()*128+64).toString(16)
                                  + Math.round(randn_bm()*128+64).toString(16)
                                  + Math.round(randn_bm()*128+64).toString(16);
        ball["state"]["r"] = 16*(randn_bm() + 1);
        dot_list.push({ "x": ball["prev"]["x"], "y": ball["prev"]["y"] });
      }

      const elapsed = time - last;

      const interval = 1000;
      draw(elapsed / interval);

      if(elapsed && elapsed >= interval) {
        last = time;

        // maybe make a ball "updateState" function?
        ball["prev"]["x"] = ball["state"]["x"];
        ball["prev"]["y"] = ball["state"]["y"];
        ball["prev"]["color"] = ball["state"]["color"]
        ball["prev"]["r"] = ball["state"]["r"];
        ball["state"]["x"] = randn_bm()*(canvas.width - 2*ball["state"]["r"]) + ball["state"]["r"];
        ball["state"]["y"] = randn_bm()*(canvas.height - 2*ball["state"]["r"]) + ball["state"]["r"];
        ball["state"]["color"] = "#" + Math.round(randn_bm()*128+64).toString(16)
                                  + Math.round(randn_bm()*128+64).toString(16)
                                  + Math.round(randn_bm()*128+64).toString(16);
        ball["state"]["r"] = 16*(randn_bm() + 1);
        dot_list.push({ "x": ball["prev"]["x"], "y": ball["prev"]["y"] });
      }

      
      // iterate
      window.requestAnimationFrame(loop);
    }

    // for each object, have that object specify how it should be drawn
    // this function will draw the object in that way
    // also, should iterate through a list of objects
    // need concept of "previous state" to undraw small number of objects,
    // or use the blank-out canvas method for large scenes to be rendered
    function draw(k) {
      // clear canvas
      ctx.fillStyle = "#fff";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      const x = ball["prev"]["x"];
      const y = ball["prev"]["y"];
      const r = ball["prev"]["r"];
      const dx = ball["state"]["x"] - ball["prev"]["x"];
      const dy = ball["state"]["y"] - ball["prev"]["y"];
      const dr = ball["state"]["r"] - ball["prev"]["r"];
      const tr = ball["state"]["r"];

      ctx.fillStyle = "#000";
      let dot;
      for(dot in dot_list) {
        ctx.beginPath();
        ctx.arc(dot_list[dot]["x"], dot_list[dot]["y"], 2, 0, 2*Math.PI);
        ctx.fill();
      }

      if(k > 1) k = 1;
      
      const R = parseInt(ball["prev"]["color"].substring(1, 3), 16);
      const G = parseInt(ball["prev"]["color"].substring(3, 5), 16);
      const B = parseInt(ball["prev"]["color"].substring(5, 7), 16);
      const dR = parseInt(ball["state"]["color"].substring(1, 3), 16) - R;
      const dG = parseInt(ball["state"]["color"].substring(3, 5), 16) - G;
      const dB = parseInt(ball["state"]["color"].substring(5, 7), 16) - B;
      
      // draw things
      ctx.fillStyle = "#" + Math.round(R+k*dR).toString(16)
                          + Math.round(G+k*dG).toString(16)
                          + Math.round(B+k*dB).toString(16);
      ctx.beginPath();
      ctx.arc(x+k*dx, y+k*dy, r+k*dr, 0, 2*Math.PI);
      ctx.fill();
    }

    // setup
    window.addEventListener("load", e => {
      init();
    });
  </script>
</head>
<body>
  <!-- nothing is here -->
</body>
</html>
